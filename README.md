# Сервис для расчета скидок

Данный REST API сервис вычисляет итоговую стоимость товара с учетом скидки на основе переданных параметров.
Если для переданных параметров скидка не найдена, то возвращается исходная стоимость продукта.
### Список эндпоинтов
- `/discount/fixed` вычисляет фиксированную скидку.
- `/discount/variable` вычисляет переменную скидку.

Все эндпоинты возвращают итоговую стоимость и принимают следующие параметры:
- `price`: начальная стоимость продукта, для которого рассчитывается скидка.
- `product_category` ID категории продукта.
- `client_category` ID категории клиента.

Данные параметры являются **обязательными**.

### Доступные значения
`product_category`:</br>
ID: 1 - Электроника</br>
ID: 2 - Одежда</br>
ID: 3 - Еда</br>
ID: 4 - Бытовая химия</br>

`client_category`:</br>
ID: 1 - Обычный покупатель</br>
ID: 2 - Постоянный клиент</br>

### Конфигурация и запуск

#### Предварительные требования для запуска
- Java 17+
- Gradle 7.x+

#### Конфигурация Docker Compose
Основные переменные окружения можно задать в `docker-compose.yaml`
```yaml
environment:
  SPRING_DATASOURCE_URL: jdbc:mysql://database:3306/discount_service
  SPRING_DATASOURCE_USERNAME: mysql
  SPRING_DATASOURCE_PASSWORD: mysql
  DISCOUNT_AGGREGATION: false
```
Флаг `DISCOUNT_AGGREGATION` указывает, должны ли скидки суммироваться. Если скидки суммируются, то итоговая стоимость учитывает все возможные скидки для переданных `product_category` и `client_category`. В ином случае учитывается более специфичная скидка для переданных значений. Порядок поиска скидок:
1. Поиск скидок для `product_category` и `client_category`.
2. Поиск скидок для `product_category`. `client_category` не учитывается. Данный тип скидки распространяется на все категории клиентов.
3. Поиск скидок для `client_category`. `product_category` не учитывается. Данный тип скидки распространяется на все категории товаров.
4. Поиск скидок, в которых не учитывается `client_category` и `product_category`. Данный тип скидок распространяется на все товары и для всех категорий клиентов.

#### Сборка приложения
1. Соберите JAR-файл с помощью Gradle:
```bash
./gradlew bootJar
```
Собранный JAR будет находиться в `build/libs/discount-service.jar`

2. Соберите Docker-образ:
```bash
docker build -t discount-service .
```

3. Запустите Docker Compose:
```bash
docker-compose up
```
